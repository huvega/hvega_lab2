<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hugo Vega">

<title>Lab 2: Data Tidying</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Lab2_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lab2_files/libs/quarto-html/quarto.js"></script>
<script src="Lab2_files/libs/quarto-html/popper.min.js"></script>
<script src="Lab2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lab2_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lab2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lab2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lab2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lab2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lab2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 2: Data Tidying</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hugo Vega </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>Overview</h1>
<p>In this assignment you will work to tidy, clean, and analyze two different datasets, the first is a small dataset contained in a csv file called <a href="https://github.com/georgehagstrom/DATA607/website/assignments/labs/labData/flightdelays.csv">flightdelays.csv</a>, and the second called <a href="https://github.com/georgehagstrom/DATA607/website/assignments/labs/labData/MixedDrinkRecipes-Prep.csv">MixedDrinkRecipes-Prep.csv</a>.</p>
<p>The most important book chapters which cover the techniques you will practice here are R4DS Chapters 5 and 7. Also helpful are the <a href="https://tidyr.tidyverse.org/articles/pivot.html"><code>tidyr</code> vignette on pivoting</a> and the ggplot help page on the <a href="https://ggplot2.tidyverse.org/reference/geom_dotplot.html">geom_dotplot</a>.</p>
<p>Submit your completed assignment on the course brightspace page by uploading your <code>.qmd</code> file and a compiled <code>pdf</code> or link to a compiled <code>html</code>, which you could host on your <code>github</code> or <code>rpubs</code> page as you wish.</p>
</section>
<section id="part-1-airplane-flight-delays" class="level1">
<h1>Part 1: Airplane flight delays</h1>
<p>Consider the following dataset:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 11%">
<col style="width: 14%">
<col style="width: 20%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: right;">Los_Angeles</th>
<th style="text-align: right;">Phoenix</th>
<th style="text-align: right;">San_Diego</th>
<th style="text-align: right;">San_Francisco</th>
<th style="text-align: right;">Seattle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ALASKA</td>
<td style="text-align: left;">On_Time</td>
<td style="text-align: right;">497</td>
<td style="text-align: right;">221</td>
<td style="text-align: right;">212</td>
<td style="text-align: right;">503</td>
<td style="text-align: right;">1841</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Delayed</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">305</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AM WEST</td>
<td style="text-align: left;">On_Time</td>
<td style="text-align: right;">694</td>
<td style="text-align: right;">4840</td>
<td style="text-align: right;">383</td>
<td style="text-align: right;">320</td>
<td style="text-align: right;">301</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Delayed</td>
<td style="text-align: right;">117</td>
<td style="text-align: right;">415</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">129</td>
<td style="text-align: right;">61</td>
</tr>
</tbody>
</table>
<p>The above table describes arrival delays for two different airlines across several destinations. The numbers correspond the the number of flights that were in either the delayed category or the on time category.</p>
</section>
<section id="problems" class="level1">
<h1>Problems</h1>
<p><strong>Problem 1:</strong> Read the information from <code>flightdelays.csv</code> into R, and use <code>tidyr</code> and <code>dplyr</code> to convert this data into a tidy/tall format with names and complete data for all columns. Your final data frame should have <code>City</code>, <code>On_Time_Flights</code> and <code>Delayed_Flights</code> as columns (the exact names are up to you). In addition to <code>pivot_longer</code>, <code>pivot_wider</code> and <code>rename</code>, you might find the <code>tidyr</code> function <a href="https://tidyr.tidyverse.org/reference/fill.html"><code>fill</code></a> helpful for completing this task efficiently. Although this is a small dataset that you could easily reshape by hand, you should solve this problem using tidyverse functions that do the work for you.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>flightdelay <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">'flightdelays.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot longer</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>flightdelay1 <span class="ot">&lt;-</span> flightdelay <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">'Los_Angeles'</span><span class="sc">:</span><span class="st">'Seattle'</span>, <span class="at">names_to =</span> <span class="st">'City'</span>, <span class="at">values_to =</span> <span class="st">'N_of_flights'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename df columns</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>flightdelay2 <span class="ot">&lt;-</span> flightdelay1 <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="st">'Airline'</span><span class="ot">=</span><span class="st">'...1'</span>, <span class="st">'Status'</span><span class="ot">=</span><span class="st">'...2'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing Airline values</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>flightdelay2 <span class="ot">&lt;-</span> flightdelay2 <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(Airline, <span class="at">.direction =</span> <span class="st">"down"</span>)  <span class="co"># Fill downwards within each group</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>flightdelay2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
   Airline Status  City          N_of_flights
   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;
 1 ALASKA  On_Time Los_Angeles            497
 2 ALASKA  On_Time Phoenix                221
 3 ALASKA  On_Time San_Diego              212
 4 ALASKA  On_Time San_Francisco          503
 5 ALASKA  On_Time Seattle               1841
 6 ALASKA  Delayed Los_Angeles             62
 7 ALASKA  Delayed Phoenix                 12
 8 ALASKA  Delayed San_Diego               20
 9 ALASKA  Delayed San_Francisco          102
10 ALASKA  Delayed Seattle                305
11 AM WEST On_Time Los_Angeles            694
12 AM WEST On_Time Phoenix               4840
13 AM WEST On_Time San_Diego              383
14 AM WEST On_Time San_Francisco          320
15 AM WEST On_Time Seattle                301
16 AM WEST Delayed Los_Angeles            117
17 AM WEST Delayed Phoenix                415
18 AM WEST Delayed San_Diego               65
19 AM WEST Delayed San_Francisco          129
20 AM WEST Delayed Seattle                 61</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>flightdelay3 <span class="ot">&lt;-</span> flightdelay2 <span class="sc">|&gt;</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Status, <span class="at">values_from =</span> N_of_flights, <span class="at">values_fn =</span> sum)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sum the duplicate values</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> flightdelay3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   Airline City          On_Time Delayed
   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;
 1 ALASKA  Los_Angeles       497      62
 2 ALASKA  Phoenix           221      12
 3 ALASKA  San_Diego         212      20
 4 ALASKA  San_Francisco     503     102
 5 ALASKA  Seattle          1841     305
 6 AM WEST Los_Angeles       694     117
 7 AM WEST Phoenix          4840     415
 8 AM WEST San_Diego         383      65
 9 AM WEST San_Francisco     320     129
10 AM WEST Seattle           301      61</code></pre>
</div>
</div>
<p><strong>Problem 2:</strong> Take the data-frame that you tidied and cleaned in Problem 1 and create additional columns which contain the fraction of on-time and delayed flights at each airport. Then create a dot-plot using the <code>geom_dotplot</code> function (see the <a href="">ggplot page for dotplot</a>) to visualize the difference in flight delays between the two airlines at each city in the dataset. What conclusions can you draw from the dotplot?</p>
<p>Optional: If you want to make a fancier visualization consider adding text labels containing the airline names above the dots using <code>geom_text</code> and <code>position = position_nudge(...)</code> with appropriate arguments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate fractions of on-time and delayed flights</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>flightdelay4 <span class="ot">&lt;-</span> flightdelay3 <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Airline, City) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fraction_on_time =</span> On_Time <span class="sc">/</span> <span class="fu">sum</span>(On_Time, Delayed),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">fraction_delayed =</span> Delayed <span class="sc">/</span> <span class="fu">sum</span>(On_Time, Delayed))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>flightdelay4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
# Groups:   Airline, City [10]
   Airline City          On_Time Delayed fraction_on_time fraction_delayed
   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
 1 ALASKA  Los_Angeles       497      62            0.889           0.111 
 2 ALASKA  Phoenix           221      12            0.948           0.0515
 3 ALASKA  San_Diego         212      20            0.914           0.0862
 4 ALASKA  San_Francisco     503     102            0.831           0.169 
 5 ALASKA  Seattle          1841     305            0.858           0.142 
 6 AM WEST Los_Angeles       694     117            0.856           0.144 
 7 AM WEST Phoenix          4840     415            0.921           0.0790
 8 AM WEST San_Diego         383      65            0.855           0.145 
 9 AM WEST San_Francisco     320     129            0.713           0.287 
10 AM WEST Seattle           301      61            0.831           0.169 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ggrepel"</span>)  <span class="co"># Install if you haven't already</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dot plot</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flightdelay4, <span class="fu">aes</span>(<span class="at">x =</span> City, <span class="at">y =</span> fraction_delayed, <span class="at">color =</span> Airline)) <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dotplot</span>(<span class="at">binaxis =</span> <span class="st">"y"</span>, <span class="at">stackdir =</span> <span class="st">"center"</span>, <span class="at">dotsize =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span>  <span class="co"># Format y-axis as percentages</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparison of Flight Delay Fractions by Airline and City"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"City"</span>, <span class="at">y =</span> <span class="st">"Fraction of Delayed Flights"</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="co"># Rotate x-axis labels for better readability</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Bin width defaults to 1/30 of the range of the data. Pick better value with
`binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Add text labels for airlines (requires 'ggrepel' package)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flightdelay4, <span class="fu">aes</span>(<span class="at">x =</span> City, <span class="at">y =</span> fraction_delayed, <span class="at">color =</span> Airline, <span class="at">label =</span> Airline)) <span class="sc">+</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dotplot</span>(<span class="at">binaxis =</span> <span class="st">"y"</span>, <span class="at">stackdir =</span> <span class="st">"center"</span>, <span class="at">dotsize =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">y =</span> <span class="fl">0.02</span>),  <span class="co"># Adjust nudge as needed</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Adjust text size as needed</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparison of Flight Delay Fractions by Airline and City"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"City"</span>, <span class="at">y =</span> <span class="st">"Fraction of Delayed Flights"</span>) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Bin width defaults to 1/30 of the range of the data. Pick better value with
`binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab2_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Part 1</strong> <strong><em>Discussion</em></strong> The fraction of delay flight increase with the size of the airport, Phoenix has the lowest ration while San Francisco hast the highest ratio of delayed flights. However one airline has lower performance that the other in both of the ariports.</p>
</section>
<section id="part-2-mixed-drink-recipes" class="level1">
<h1>Part 2: Mixed Drink Recipes</h1>
<p>In the second part of this assignment we will be working with a dataset containing ingredients for different types of mixed drinks. This dataset is untidy and messy- it is in a wide data format and contains some inconsistencies that should be fixed.</p>
</section>
<section id="problems-1" class="level1">
<h1>Problems</h1>
<p><strong>Problem 3</strong> Load the mixed drink recipe dataset into R from the file <code>MixedDrinkRecipes-prep.csv</code>, which you can download from my github page by <a href="https://github.com/georgehagstrom/DATA607/website/assignments/labs/labData/MixedDrinkRecipes-Prep.csv">clicking here</a>. The variables <code>ingredient1</code> through <code>ingredient6</code> list the ingredients of the cocktail listed in the <code>name</code> column. Notice that there are many <code>NA</code> values in the ingredient columns, indicating that most cocktails have under 6 ingredients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cocktail <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">'MixedDrinkRecipes-Prep.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tidy this dataset using <code>pivot_longer</code> to create a new data frame where each there is a row corresponding to each ingredient of all the cocktails, and an additional variable specifying the “rank” of that cocktail in the original recipe, i.e.&nbsp;it should look like this:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 25%">
<col style="width: 22%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">category</th>
<th style="text-align: right;">Ingredient_Rank</th>
<th style="text-align: left;">Ingredient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Gauguin</td>
<td style="text-align: left;">Cocktail Classics</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Light Rum</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gauguin</td>
<td style="text-align: left;">Cocktail Classics</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Passion Fruit Syrup</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gauguin</td>
<td style="text-align: left;">Cocktail Classics</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Lemon Juice</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gauguin</td>
<td style="text-align: left;">Cocktail Classics</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">Lime Juice</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fort Lauderdale</td>
<td style="text-align: left;">Cocktail Classics</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Light Rum</td>
</tr>
</tbody>
</table>
<p>where the data-type of <code>Ingredient_Rank</code> is an integer. Hint: Use the <code>parse_number()</code> function in mutate after your initial pivot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cocktail1 <span class="ot">&lt;-</span> cocktail <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> ingredient1<span class="sc">:</span>ingredient6, <span class="at">names_to =</span> <span class="st">"Ingredient_Rank"</span>, <span class="at">names_transform =</span> readr<span class="sc">::</span>parse_number, <span class="at">values_to =</span> <span class="st">"Ingredient"</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>cocktail1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,934 × 4
   name            category              Ingredient_Rank Ingredient         
   &lt;chr&gt;           &lt;chr&gt;                           &lt;dbl&gt; &lt;chr&gt;              
 1 Gauguin         Cocktail Classics                   1 Light Rum          
 2 Gauguin         Cocktail Classics                   2 Passion Fruit Syrup
 3 Gauguin         Cocktail Classics                   3 Lemon Juice        
 4 Gauguin         Cocktail Classics                   4 Lime Juice         
 5 Fort Lauderdale Cocktail Classics                   1 Light Rum          
 6 Fort Lauderdale Cocktail Classics                   2 Sweet Vermouth     
 7 Fort Lauderdale Cocktail Classics                   3 Juice of Orange    
 8 Fort Lauderdale Cocktail Classics                   4 Juice of a Lime    
 9 Apple Pie       Cordials and Liqueurs               1 Apple schnapps     
10 Apple Pie       Cordials and Liqueurs               2 Cinnamon schnapps  
# ℹ 3,924 more rows</code></pre>
</div>
</div>
<p><strong>Problem 4:</strong> Some of the ingredients in the ingredient list have different names, but are nearly the same thing. An example include <code>Lemon Juice</code> versus <code>Juice of a lemon</code>. Make a list of the ingredients appearing in the ingredient list ranked by how commonly they occur along with the number of occurrences, and print the first 10 elements of the list here. Then check more ingredients (I suggest looking at more ingredients and even sorting them alphabetically using <code>arrange(asc(ingredient)))</code> and see if you can spot pairs of ingredients that are similar but have different names. Use <code>if_else</code>( <a href="https://dplyr.tidyverse.org/reference/if_else.html">click here for if_else</a> ) in combination with <code>mutate</code> to make it so that the pairs of ingredients you found have the same name. You don’t have to find all pairs, but find at least 5 pairs of ingredients to rename. Because the purpose of this renaming is to facilitate a hypothetical future analysis, you can choose your own criteria for similarity as long as it is somewhat justifiable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences of each ingredient</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ingredient_counts <span class="ot">&lt;-</span> cocktail1 <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Ingredient) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Count))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the top 10 ingredients</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(ingredient_counts, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   Ingredient        Count
   &lt;chr&gt;             &lt;int&gt;
 1 Gin                 176
 2 Fresh lemon juice   138
 3 Simple Syrup        115
 4 Light Rum           114
 5 Vodka               114
 6 Dry Vermouth        107
 7 Fresh Lime Juice    107
 8 Triple Sec          107
 9 Powdered Sugar       90
10 Grenadine            85</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort ingredients alphabetically</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>sorted_ingredients <span class="ot">&lt;-</span> cocktail1 <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Ingredient) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Ingredient)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the sorted ingredients (you'll need to visually inspect this output)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sorted_ingredients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 673 × 1
   Ingredient                             
   &lt;chr&gt;                                  
 1 100-proof Vodka                        
 2 151-Proof Rum                          
 3 17-year-old J. Wray and Nephew Ltd. Rum
 4 7-Up                                   
 5 Absinthe                               
 6 Absinthe Substitute                    
 7 Absinthe or pastis                     
 8 Acai berry flavored vodka              
 9 African rum                            
10 Agave nectar                           
# ℹ 663 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize ingredient names</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>cocktail2 <span class="ot">&lt;-</span> cocktail1 <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ingredient =</span> <span class="fu">if_else</span>(Ingredient <span class="sc">==</span> <span class="st">"Lemon Juice"</span>, <span class="st">"Juice of a Lemon"</span>, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">if_else</span>(Ingredient <span class="sc">==</span> <span class="st">"Lime Juice"</span>, <span class="st">"Juice of a Lime"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">if_else</span>(Ingredient <span class="sc">==</span> <span class="st">"Almond milk"</span>, <span class="st">"Almond extract"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">if_else</span>(Ingredient <span class="sc">==</span> <span class="st">"Orange Juice"</span>, <span class="st">"Juice of an Orange"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fu">if_else</span>(Ingredient <span class="sc">==</span> <span class="st">"Absithe Substitute"</span>, <span class="st">"Absithe"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                                                              Ingredient))))))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print first few rows to verify</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(cocktail2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name            category          Ingredient_Rank Ingredient         
  &lt;chr&gt;           &lt;chr&gt;                       &lt;dbl&gt; &lt;chr&gt;              
1 Gauguin         Cocktail Classics               1 Light Rum          
2 Gauguin         Cocktail Classics               2 Passion Fruit Syrup
3 Gauguin         Cocktail Classics               3 Juice of a Lemon   
4 Gauguin         Cocktail Classics               4 Juice of a Lime    
5 Fort Lauderdale Cocktail Classics               1 Light Rum          
6 Fort Lauderdale Cocktail Classics               2 Sweet Vermouth     </code></pre>
</div>
</div>
<p>Notice that there are some ingredients that appear to be two or more ingredients strung together with commas. These would be candidates for more cleaning though this exercise doesn’t ask you to fix them.</p>
<p><strong>Problem 5:</strong> Some operations are easier to do on <code>wide</code> data rather than <code>tall</code> data. Find the 10 most common pairs of ingredients occurring in the top 2 ingredients in a recipe. It is much easier to do this with a <code>wide</code> dataset, so use <code>pivot_wider</code> to change the data so that each row contains all of the ingredients of a single cocktail, just like in the format of the original data-set. Then use <code>count</code> on the <code>1</code> and <code>2</code> rows to determine the most common pairs (see chapter 3 for a refresher on <code>count</code>).</p>
<p>Note: You may be interested to read about the <code>widyr</code> package here: <a href="https://rdrr.io/cran/widyr/f/README.md">widyr page</a>. It is designed to solve problems like this one and uses internal pivot steps to accomplish it so that the final result is tidy. I’m actually unaware of any easy ways of solving problem 5 without pivoting to a wide dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the dataframe back to wide format</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cocktail_wide <span class="ot">&lt;-</span> cocktail2 <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(name, category),<span class="at">names_from =</span> Ingredient_Rank, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> Ingredient) </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the most common pairs of ingredients in columns 1 and 2</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>top_ingredient_pairs <span class="ot">&lt;-</span> cocktail_wide <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span>, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the top 10 pairs</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(top_ingredient_pairs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   `1`              `2`                   n
   &lt;chr&gt;            &lt;chr&gt;             &lt;int&gt;
 1 Juice of a Lemon Powdered Sugar       24
 2 Gin              Dry Vermouth         23
 3 Whole Egg        Powdered Sugar       13
 4 Light Rum        Fresh Lime Juice     12
 5 Gin              Triple Sec            9
 6 Bourbon whiskey  Fresh lemon juice     8
 7 Brandy           Sweet Vermouth        7
 8 Gin              Sweet Vermouth        7
 9 Light Rum        Pineapple Juice       7
10 Light Rum        Sweet Vermouth        7</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>